metadata:
  name: RadarAPI
projects:
  - name: radar-numeriqc-api
    source:
      location: 'https://github.com/CQEN-QDCE/Radar-NumeriQc-API'
      type: git
      branch: nodejs-express-postgres
components:
  - mountSources: true
    endpoints:
      - name: nodejs
        port: 3000
    memoryLimit: 1Gi
    type: dockerimage
    volumes:
      - name: nodejs
        containerPath: /home/user
    image: >-
      registry.redhat.io/codeready-workspaces/plugin-java8-rhel8@sha256:d04f70c8340abaee1a282b77158d054f4faf2225bc17c79aafb413396c367782
    alias: nodejs
  - mountSources: true
    endpoints:
      - name: postgresql-database
        port: 5432
        attributes:
          discoverable: 'true'
          public: 'false'
    memoryLimit: 256Mi
    type: dockerimage
    volumes:
      - name: postgresql-storage
        containerPath: /var/lib/pgsql/data
    image: centos/postgresql-10-centos7
    alias: postgresql
    env:
      - value: radar
        name: POSTGRESQL_USER
      - value: radar00
        name: POSTGRESQL_PASSWORD
      - value: radar
        name: POSTGRESQL_DATABASE
apiVersion: 1.0.0
commands:
  - name: npm install
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}/Radar-NumeriQc-API/nodejs-express-postgres'
        type: exec
        command: npm install
        component: nodejs
  - name: npm install express pg
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}/Radar-NumeriQc-API'
        type: exec
        command: npm i express pg
        component: nodejs
  - name: Run the web app
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}/Radar-NumeriQc-API'
        type: exec
        command: node app.js
        component: nodejs
  - name: 4. Run the web app (debugging enabled)
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}/Radar-NumeriQc-API'
        type: exec
        command: node --inspect app.js
        component: nodejs
